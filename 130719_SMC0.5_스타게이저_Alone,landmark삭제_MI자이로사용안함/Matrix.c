#include "Matrix.h"

void mtx_mul_4x4(double ANS[4][4],double A[4][4],double B[4][4]){
	double buffer[4][4]={{0,0,0,0},{0,0,0,0},{0,0,0,0},{0,0,0,0}};
	for(int i=0;i<4;i++)
		for(int j=0;j<4;j++)
			for(int k=0;k<4;k++)
				buffer[i][j]+= A[i][k]*B[k][j];
	for(int i=0;i<4;i++)
		for(int j=0;j<4;j++)
			ANS[i][j]=buffer[i][j];
}
void mtx_mul_2x2(double ANS[2][2],double A[2][2],double B[2][2]){
	double buffer[2][2]={{0,0},{0,0}};
	for(int i=0;i<2;i++)
		for(int j=0;j<2;j++)
			for(int k=0;k<2;k++)
				buffer[i][j]+= A[i][k]*B[k][j];
	for(int i=0;i<2;i++)
		for(int j=0;j<2;j++)
			ANS[i][j]=buffer[i][j];
}
void mtx_mul_2x1(double ANS[2],double A[2][2],double B[2]){
	double buffer[2]={0,0};
	for(int i=0;i<2;i++)
		for(int j=0;j<2;j++)
				buffer[i]+= A[i][j]*B[j];
	for(int i=0;i<2;i++)
			ANS[i]=buffer[i];
}
void mtx_add_2x2(double ANS[2][2],double A[2][2],double B[2][2],double s){
	for(int i=0;i<2;i++)
		for(int j=0;j<2;j++)
			ANS[i][j]= A[i][j]+s*B[i][j];
}
void mtx_add_2x1(double ANS[2],double A[2],double B[2],double s){
	for(int i=0;i<2;i++)
		ANS[i]= A[i]+s*B[i];
}
void mtx_inv_2x2(double ANS[2][2],double A[2][2]){
	double det=A[0][0]*A[1][1]-A[0][1]*A[1][0];
	double buffer[2][2];
	if(det==0)
		return;
	else{
		buffer[0][0]=A[1][1]/det;
		buffer[0][1]=-A[0][1]/det;
		buffer[1][0]=-A[1][0]/det;
		buffer[1][1]=A[0][0]/det;
	for(int i=0;i<2;i++)
		for(int j=0;j<2;j++)
			ANS[i][j]=buffer[i][j];
	}
}


int mtx_inv_4x4(double ANS[4][4], double A[4][4]){
	double TA[4][4];
	double scale=mtx_det_4x4(A);
	if(scale==0)
		return 0;
	else{
	   TA[0][0] = (  A[1][2]*A[2][3]*A[3][1] - A[1][3]*A[2][2]*A[3][1] + A[1][3]*A[2][1]*A[3][2] - A[1][1]*A[2][3]*A[3][2] - A[1][2]*A[2][1]*A[3][3] + A[1][1]*A[2][2]*A[3][3] ) / scale ;
	   TA[0][1] = (  A[0][3]*A[2][2]*A[3][1] - A[0][2]*A[2][3]*A[3][1] - A[0][3]*A[2][1]*A[3][2] + A[0][1]*A[2][3]*A[3][2] + A[0][2]*A[2][1]*A[3][3] - A[0][1]*A[2][2]*A[3][3] ) / scale ;
	   TA[0][2] = (  A[0][2]*A[1][3]*A[3][1] - A[0][3]*A[1][2]*A[3][1] + A[0][3]*A[1][1]*A[3][2] - A[0][1]*A[1][3]*A[3][2] - A[0][2]*A[1][1]*A[3][3] + A[0][1]*A[1][2]*A[3][3] ) / scale ;
	   TA[0][3] = (  A[0][3]*A[1][2]*A[2][1] - A[0][2]*A[1][3]*A[2][1] - A[0][3]*A[1][1]*A[2][2] + A[0][1]*A[1][3]*A[2][2] + A[0][2]*A[1][1]*A[2][3] - A[0][1]*A[1][2]*A[2][3] ) / scale ;
	   TA[1][0] = (  A[1][3]*A[2][2]*A[3][0] - A[1][2]*A[2][3]*A[3][0] - A[1][3]*A[2][0]*A[3][2] + A[1][0]*A[2][3]*A[3][2] + A[1][2]*A[2][0]*A[3][3] - A[1][0]*A[2][2]*A[3][3] ) / scale ;
	   TA[1][1] = (  A[0][2]*A[2][3]*A[3][0] - A[0][3]*A[2][2]*A[3][0] + A[0][3]*A[2][0]*A[3][2] - A[0][0]*A[2][3]*A[3][2] - A[0][2]*A[2][0]*A[3][3] + A[0][0]*A[2][2]*A[3][3] ) / scale ;
	   TA[1][2] = (  A[0][3]*A[1][2]*A[3][0] - A[0][2]*A[1][3]*A[3][0] - A[0][3]*A[1][0]*A[3][2] + A[0][0]*A[1][3]*A[3][2] + A[0][2]*A[1][0]*A[3][3] - A[0][0]*A[1][2]*A[3][3] ) / scale ;
	   TA[1][3] = (  A[0][2]*A[1][3]*A[2][0] - A[0][3]*A[1][2]*A[2][0] + A[0][3]*A[1][0]*A[2][2] - A[0][0]*A[1][3]*A[2][2] - A[0][2]*A[1][0]*A[2][3] + A[0][0]*A[1][2]*A[2][3] ) / scale ;
	   TA[2][0] = (  A[1][1]*A[2][3]*A[3][0] - A[1][3]*A[2][1]*A[3][0] + A[1][3]*A[2][0]*A[3][1] - A[1][0]*A[2][3]*A[3][1] - A[1][1]*A[2][0]*A[3][3] + A[1][0]*A[2][1]*A[3][3] ) / scale ;
	   TA[2][1] = (  A[0][3]*A[2][1]*A[3][0] - A[0][1]*A[2][3]*A[3][0] - A[0][3]*A[2][0]*A[3][1] + A[0][0]*A[2][3]*A[3][1] + A[0][1]*A[2][0]*A[3][3] - A[0][0]*A[2][1]*A[3][3] ) / scale ;
	   TA[2][2] = (  A[0][1]*A[1][3]*A[3][0] - A[0][3]*A[1][1]*A[3][0] + A[0][3]*A[1][0]*A[3][1] - A[0][0]*A[1][3]*A[3][1] - A[0][1]*A[1][0]*A[3][3] + A[0][0]*A[1][1]*A[3][3] ) / scale ;
	   TA[2][3] = (  A[0][3]*A[1][1]*A[2][0] - A[0][1]*A[1][3]*A[2][0] - A[0][3]*A[1][0]*A[2][1] + A[0][0]*A[1][3]*A[2][1] + A[0][1]*A[1][0]*A[2][3] - A[0][0]*A[1][1]*A[2][3] ) / scale ;
	   TA[3][0] = (  A[1][2]*A[2][1]*A[3][0] - A[1][1]*A[2][2]*A[3][0] - A[1][2]*A[2][0]*A[3][1] + A[1][0]*A[2][2]*A[3][1] + A[1][1]*A[2][0]*A[3][2] - A[1][0]*A[2][1]*A[3][2] ) / scale ;
	   TA[3][1] = (  A[0][1]*A[2][2]*A[3][0] - A[0][2]*A[2][1]*A[3][0] + A[0][2]*A[2][0]*A[3][1] - A[0][0]*A[2][2]*A[3][1] - A[0][1]*A[2][0]*A[3][2] + A[0][0]*A[2][1]*A[3][2] ) / scale ;
	   TA[3][2] = (  A[0][2]*A[1][1]*A[3][0] - A[0][1]*A[1][2]*A[3][0] - A[0][2]*A[1][0]*A[3][1] + A[0][0]*A[1][2]*A[3][1] + A[0][1]*A[1][0]*A[3][2] - A[0][0]*A[1][1]*A[3][2] ) / scale ;
	   TA[3][3] = (  A[0][1]*A[1][2]*A[2][0] - A[0][2]*A[1][1]*A[2][0] + A[0][2]*A[1][0]*A[2][1] - A[0][0]*A[1][2]*A[2][1] - A[0][1]*A[1][0]*A[2][2] + A[0][0]*A[1][1]*A[2][2] ) / scale ;
	   ANS[0][0]=TA[0][0];
	   ANS[0][1]=TA[0][1];
	   ANS[0][2]=TA[0][2];
	   ANS[0][3]=TA[0][3];
	   ANS[1][0]=TA[1][0];
	   ANS[1][1]=TA[1][1];
	   ANS[1][2]=TA[1][2];
	   ANS[1][3]=TA[1][3];
	   ANS[2][0]=TA[2][0];
	   ANS[2][1]=TA[2][1];
	   ANS[2][2]=TA[2][2];
	   ANS[2][3]=TA[2][3];
	   ANS[3][0]=TA[3][0];
	   ANS[3][1]=TA[3][1];
	   ANS[3][2]=TA[3][2];
	   ANS[3][3]=TA[3][3];
	   return 1;
	}
}



double mtx_det_4x4( double A[4][4]) {
   double value;
   value =
   A[0][3]*A[1][2]*A[2][1]*A[3][0] - A[0][2]*A[1][3]*A[2][1]*A[3][0] - A[0][3]*A[1][1]*A[2][2]*A[3][0] + A[0][1]*A[1][3]*A[2][2]*A[3][0]+
   A[0][2]*A[1][1]*A[2][3]*A[3][0] - A[0][1]*A[1][2]*A[2][3]*A[3][0] - A[0][3]*A[1][2]*A[2][0]*A[3][1] + A[0][2]*A[1][3]*A[2][0]*A[3][1]+
   A[0][3]*A[1][0]*A[2][2]*A[3][1] - A[0][0]*A[1][3]*A[2][2]*A[3][1] - A[0][2]*A[1][0]*A[2][3]*A[3][1] + A[0][0]*A[1][2]*A[2][3]*A[3][1]+
   A[0][3]*A[1][1]*A[2][0]*A[3][2] - A[0][1]*A[1][3]*A[2][0]*A[3][2] - A[0][3]*A[1][0]*A[2][1]*A[3][2] + A[0][0]*A[1][3]*A[2][1]*A[3][2]+
   A[0][1]*A[1][0]*A[2][3]*A[3][2] - A[0][0]*A[1][1]*A[2][3]*A[3][2] - A[0][2]*A[1][1]*A[2][0]*A[3][3] + A[0][1]*A[1][2]*A[2][0]*A[3][3]+
   A[0][2]*A[1][0]*A[2][1]*A[3][3] - A[0][0]*A[1][2]*A[2][1]*A[3][3] - A[0][1]*A[1][0]*A[2][2]*A[3][3] + A[0][0]*A[1][1]*A[2][2]*A[3][3];
   return value;
 }


void mtx_mul_3x3(double ANS[3][3],double A[3][3],double B[3][3]){
	double buffer[3][3]={{0,0,0},{0,0,0},{0,0,0}};
	for(int i=0;i<3;i++)
		for(int j=0;j<3;j++)
			for(int k=0;k<3;k++)
				buffer[i][j]+= A[i][k]*B[k][j];
	for(int i=0;i<3;i++)
		for(int j=0;j<3;j++)
			ANS[i][j]=buffer[i][j];
}

void mtx_mul_10x10(double ANS[10][10],double A[10][10],double B[10][10]){
	int i,j,k;
	double buffer[10][10]={{0,0,0,0,0,0,0,0,0,0},
						   {0,0,0,0,0,0,0,0,0,0},
						   {0,0,0,0,0,0,0,0,0,0},
						   {0,0,0,0,0,0,0,0,0,0},
						   {0,0,0,0,0,0,0,0,0,0},
						   {0,0,0,0,0,0,0,0,0,0},
						   {0,0,0,0,0,0,0,0,0,0},
						   {0,0,0,0,0,0,0,0,0,0},
						   {0,0,0,0,0,0,0,0,0,0},
						   {0,0,0,0,0,0,0,0,0,0}};
	for( i=0;i<10;i++)
		for( j=0;j<10;j++)
			for( k=0;k<10;k++)
				buffer[i][j]+= A[i][k]*B[k][j];
	for( i=0;i<10;i++)
		for( j=0;j<10;j++)
			ANS[i][j]=buffer[i][j];
}

void mtx_mul_3x1(double ANS[3],double A[3][3],double B[3]){
	double buffer[3]={0,0,0};
	for(int i=0;i<3;i++)
		for(int j=0;j<3;j++)
				buffer[i]+= A[i][j]*B[j];
	for(int i=0;i<3;i++)
			ANS[i]=buffer[i];
}

void mtx_mul_10x1(double ANS[10],double A[10][10],double B[10]){
	int i,j;
	double buffer[10]={0,0,0,0,0,0,0,0,0,0};
	for( i=0;i<10;i++)
		for( j=0;j<10;j++)
				buffer[i]+= A[i][j]*B[j];
	for( i=0;i<10;i++)
			ANS[i]=buffer[i];
}

void mtx_add_3x3(double ANS[3][3],double A[3][3],double B[3][3],double s){
	for(int i=0;i<3;i++)
		for(int j=0;j<3;j++)
			ANS[i][j]= A[i][j]+s*B[i][j];
}

void mtx_add_10x10(double ANS[10][10],double A[10][10],double B[10][10],double s){
	int i,j;
	for( i=0;i<10;i++)
		for( j=0;j<10;j++)
			ANS[i][j]= A[i][j]+s*B[i][j];
}

void mtx_add_3x1(double ANS[3],double A[3],double B[3],double s){
	for(int i=0;i<3;i++)
		ANS[i]= A[i]+s*B[i];
}

void mtx_add_10x1(double ANS[10],double A[10],double B[10],double s){
	int i;
	for( i=0;i<10;i++)
		ANS[i]= A[i]+s*B[i];
}


void mtx_inv_3x3(double ANS[3][3],double a[3][3]){
	double det;
	double buffer[3][3]={
	     {   a[2][2]*a[1][1]-a[2][1]*a[1][2],  -(a[2][2]*a[0][1]-a[2][1]*a[0][2]),   a[1][2]*a[0][1]-a[1][1]*a[0][2]},
	 	{-(a[2][2]*a[1][0]-a[2][0]*a[1][2]),   a[2][2]*a[0][0]-a[2][0]*a[0][2],  -(a[1][2]*a[0][0]-a[1][0]*a[0][2])},
	  	{ a[2][1]*a[1][0]-a[2][0]*a[1][1],  -(a[2][1]*a[0][0]-a[2][0]*a[0][1]),  a[1][1]*a[0][0]-a[1][0]*a[0][1]}};

	det  =  a[0][0]*(a[2][2]*a[1][1]-a[2][1]*a[1][2])-a[1][0]*(a[2][2]*a[0][1]-a[2][1]*a[0][2])+a[2][0]*(a[1][2]*a[0][1]-a[1][1]*a[0][2]);
	if(det==0)
		return;
	else{
		ANS[0][0]=buffer[0][0]/det;
		ANS[0][1]=buffer[0][1]/det;
		ANS[0][2]=buffer[0][2]/det;
		ANS[1][0]=buffer[1][0]/det;
		ANS[1][1]=buffer[1][1]/det;
		ANS[1][2]=buffer[1][2]/det;
		ANS[2][0]=buffer[2][0]/det;
		ANS[2][1]=buffer[2][1]/det;
		ANS[2][2]=buffer[2][2]/det;
	}
}
		
